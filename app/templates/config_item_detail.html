{% extends "base.html" %}
{% block content %}
<section class="panel">
  <h2>Config Item Detail</h2>
  <div class="row gap-sm wrap">
    <a class="button" href="{{ back_url }}">Back to config items</a>
    <a class="button" href="/suggestions?{{ build_query(profile_id=profile.id) }}">View Automation Suggestions</a>
    {% if active_llm_connection and snapshot.kind == "automation" and snapshot.fetch_status == "success" %}
      <form
        method="post"
        action="/profiles/{{ profile.id }}/suggestions/runs"
        data-sync-modal="true"
        data-sync-modal-label="Queueing automation concepts..."
      >
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        <input type="hidden" name="next_url" value="/suggestions?{{ build_query(profile_id=profile.id) }}" />
        <input type="hidden" name="idea_type" value="general" />
        <input type="hidden" name="custom_intent" value="Focus on improving {{ snapshot.entity_id }}" />
        <input type="hidden" name="mode" value="standard" />
        <input type="hidden" name="top_k" value="5" />
        <input type="hidden" name="include_existing" value="on" />
        <button
          type="submit"
          data-tooltip="Queue concept suggestions focused on improving this automation."
        >
          Suggest Improvement Concepts
        </button>
      </form>
    {% elif snapshot.kind == "automation" and snapshot.fetch_status == "success" %}
      <span>No enabled LLM connection configured for this profile.</span>
    {% endif %}
  </div>

  <div class="detail-grid">
    <div><strong>Profile</strong></div><div>{{ profile.name }}</div>
    <div><strong>Sync Run</strong></div><div>#{{ sync_run.id }} ({{ sync_run.status }})</div>
    <div><strong>Kind</strong></div><div>{{ snapshot.kind }}</div>
    <div><strong>Entity ID</strong></div><div><code>{{ snapshot.entity_id }}</code></div>
    <div><strong>Name</strong></div><div>{{ snapshot.name or '' }}</div>
    <div><strong>Config Key</strong></div><div><code>{{ snapshot.config_key or '' }}</code></div>
    <div><strong>Entity State</strong></div><div>{{ snapshot.state or '' }}</div>
    <div><strong>Fetch Status</strong></div><div><span class="status-chip status-{{ snapshot.fetch_status }}">{{ snapshot.fetch_status }}</span></div>
    <div><strong>Fetch Error</strong></div><div>{{ snapshot.fetch_error or '' }}</div>
    <div><strong>Last Changed</strong></div><div>{{ snapshot.last_changed or '' }}</div>
    <div><strong>Last Updated</strong></div><div>{{ snapshot.last_updated or '' }}</div>
    <div><strong>Pulled At</strong></div><div>{{ snapshot.pulled_at }}</div>
  </div>

  <h3>Summary</h3>
  <pre>{{ summary_pretty }}</pre>

  <h3>References</h3>
  <pre>{{ references_pretty }}</pre>

  <h3>Config</h3>
  <pre>{{ config_pretty }}</pre>

  <h3>State Attributes</h3>
  <pre>{{ attributes_pretty }}</pre>

  <h3>Metadata</h3>
  <pre>{{ metadata_pretty }}</pre>
</section>
{% endblock %}
